<!-- <div
[ngStyle]="{
    'font-family': formFont || 'Times New Roman, Times, serif',
    'color': '#' + (formColor || 'ff9900')
  }"
> -->
<div
  class="col-xs-12 col-sm-12 col-md-12 col-lg-12 p-2 col-xl-12"
  [ngStyle]="{
    border: '1px solid ' + formBgColor,
    'background-color': formBgColor,
    color: formFontColor || 'black',
    'font-family': formFont || 'Times New Roman, Times, serif'
  }"
>
  <div class="row">
    <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12 col-xl-12 mb-2">
      <app-title title="Specific Device Configuration" size="lg"></app-title>
    </div>
  </div>
</div>

<div class="row">
  <div class="col" *ngIf="device$ | progress | async as payload">
    <ngx-skeleton-loader
      *ngIf="payload.loading"
      [count]="5"
    ></ngx-skeleton-loader>
    <app-control-error *ngIf="payload.error">Unknown Error</app-control-error>
    <ng-container *ngIf="payload.value">
      <div
        class="container-fluid"
        [formGroup]="form"
        [ngStyle]="{
          border: '1px solid ' + formBgColor,
          'background-color': formBgColor,
          color: formFontColor || 'black',
          'font-family': formFont || 'Times New Roman, Times, serif'
        }"
      >
        <div class="row form-segment">
          <div class="col-lg-5">
            <div class="row mb-3 align-items-center">
              <mat-form-field class="col-12" appearance="outline">
                <mat-label
                  [ngStyle]="{
                    'font-family': formFont || 'Times New Roman, Times, serif',
                    color: formFontColor || 'black'
                  }"
                  >Manuf. Device Id</mat-label
                >
                <input
                  matInput
                  placeholder="Manuf. Device Id"
                  readonly
                  [value]="payload.value.device?.manufDeviceId"
                  [ngStyle]="{
                    color: formFontColor || 'black',
                    'font-family': formFont || 'Times New Roman, Times, serif',
                    'background-color': formBgColor
                  }"
                />
              </mat-form-field>
            </div>
            <!-- <input
              type="text"
              class="form-control"
              readonly
              [value]="payload.value.device?.manufDeviceId"
              placeholder="Manuf. Device Id"
              [ngStyle]="{
                color: formFontColor || 'black',
                'background-color': formBgColor,
                'border-bottom': '1px solid ' + formFontColor
              }"
            /> -->

            <div class="row mb-3">
              <mat-form-field class="col-12" appearance="outline">
                <mat-label
                  [ngStyle]="{
                    'font-family': formFont || 'Times New Roman, Times, serif',
                    color: formFontColor || 'black'
                  }"
                  >Manufacturer</mat-label
                >
                <input
                  matInput
                  readonly
                  [value]="payload.value?.device?.manufacturerName"
                  [ngStyle]="{
                    color: formFontColor || 'black',
                    'font-family': formFont || 'Times New Roman, Times, serif',
                    'background-color': formBgColor
                  }"
                />
              </mat-form-field>
            </div>
            <!-- <input
              type="text"
              class="form-control"
              readonly
              [value]="payload.value?.device?.manufacturerName"
              [ngStyle]="{
                color: formFontColor || 'black',
                'background-color': formBgColor,
                'border-bottom': '1px solid ' + formFontColor
              }"
            /> -->
          </div>

          <div class="col-lg-7">
            <div class="row mb-3 align-items-center">
              <mat-form-field class="col-12" appearance="outline">
                <mat-label
                  [ngStyle]="{
                    'font-family': formFont || 'Times New Roman, Times, serif',
                    color: formFontColor || 'black'
                  }"
                  >Device Name</mat-label
                >
                <input
                  matInput
                  readonly
                  [value]="payload.value.device?.deviceName"
                  placeholder="Device Name"
                  [ngStyle]="{
                    color: formFontColor || 'black',
                    'font-family': formFont || 'Times New Roman, Times, serif',
                    'background-color': formBgColor
                  }"
                />
              </mat-form-field>
            </div>
            <!-- <input
              type="text"
              class="form-control"
              readonly
              [value]="payload.value.device?.deviceName"
              placeholder="Device Name"
              [ngStyle]="{
                color: formFontColor || 'black',
                'background-color': formBgColor,
                'border-bottom': '1px solid ' + formFontColor
              }"
            /> -->

            <div class="row mb-3 align-items-center">
              <mat-form-field class="col-12" appearance="outline">
                <mat-label
                  [ngStyle]="{
                    'font-family': formFont || 'Times New Roman, Times, serif',
                    color: formFontColor || 'black'
                  }"
                  >Device Type</mat-label
                >
                <input
                  matInput
                  readonly
                  [value]="payload.value.device?.deviceTypeName"
                  placeholder="Device Type"
                  [ngStyle]="{
                    color: formFontColor || 'black',
                    'font-family': formFont || 'Times New Roman, Times, serif',
                    'background-color': formBgColor
                  }"
                />
              </mat-form-field>
            </div>
            <!-- <input
              type="text"
              class="form-control"
              readonly
              [value]="payload.value.device?.deviceTypeName"
              placeholder="Device Name"
              [ngStyle]="{
                color: formFontColor || 'black',
                'background-color': formBgColor,
                'border-bottom': '1px solid ' + formFontColor
              }"
            /> -->
          </div>
        </div>

        <div class="row form-segment justify-content-center">
          <div class="row">
            <app-asset-field
              class="col-lg-5 mb-3"
              formControlName="assetId"
              [subdomain]="subdomain"
              placeholder="Asset Name"
              new="true"
              (selectionChange)="changeAssetId($event)"
              [defaultValue]="form.get('assetId').value"
            ></app-asset-field>

            <app-use-case-field
              class="col-lg-5"
              formControlName="useCaseId"
              new="true"
              placeholder="Use Case"
              (selectionChange)="changeUseCaseId($event)"
              [defaultValue]="form.get('useCaseId').value"
            ></app-use-case-field>
          </div>
        </div>
        <!-- <div class="col-2"></div>

        <div class="col-2" formArrayName="alertMethods">
          <p>
            <strong>Alert Method</strong>
          </p>
          <div class="form-check option-padder" *ngFor="let type of alertTypes; index as position">
            <input class="form-check-input" [id]="type.id" [formControlName]="position" type="checkbox">
            <label class="form-check-label" [for]="type.id">{{ type.label }}</label>
          </div>

          <app-control-error *ngIf="form.get('alertMethods').invalid && form.get('alertMethods').touched">
            <span *ngIf="form.get('alertMethods').errors.required">This field is required.</span>
          </app-control-error>
        </div>

        <div class="col-6">
          <br><br>
          <ng-container
            *ngIf="alertControlValues.includes('SMS') || alertControlValues.includes('PHONE')">
            <div class="row mb-3">
              <label class="col-5 col-form-label">Phone number 1</label>
              <div class="col-7">
                <input type="phone" class="form-control" formControlName="phoneNumb1"
                  placeholder="Phone number 1">
                <app-control-error
                  *ngIf="form.get('phoneNumb1').invalid && form.get('phoneNumb1').touched">
                  <span *ngIf="form.get('phoneNumb1').errors.required">This field is
                    required.</span>
                </app-control-error>
              </div>
            </div>

            <div class="row mb-3">
              <label class="col-5 col-form-label">Phone number 2</label>
              <div class="col-7">
                <input type="phone" class="form-control" formControlName="phoneNumb2"
                  placeholder="Phone number 2">
                <app-control-error
                  *ngIf="form.get('phoneNumb2').invalid && form.get('phoneNumb2').touched">
                  <span *ngIf="form.get('phoneNumb2').errors.required">This field is
                    required.</span>
                </app-control-error>
              </div>
            </div>
          </ng-container>

          <ng-container *ngIf="alertControlValues.includes('EMAIL')">
            <div class="row mb-3">
              <label class="col-5 col-form-label">Email Address 1</label>
              <div class="col-7">
                <input type="email" class="form-control" formControlName="emailAddr1"
                  placeholder="Email Address 1">
                <app-control-error
                  *ngIf="form.get('emailAddr1').invalid && form.get('emailAddr1').touched">
                  <span *ngIf="form.get('emailAddr1').errors.required">This field is
                    required.</span>
                </app-control-error>
              </div>
            </div>

            <div class="row mb-3">
              <label class="col-5 col-form-label">Email Address 2</label>
              <div class="col-7">
                <input type="email" class="form-control" formControlName="emailAddr2"
                  placeholder="Email Address 2">
                <app-control-error
                  *ngIf="form.get('emailAddr2').invalid && form.get('emailAddr2').touched">
                  <span *ngIf="form.get('emailAddr2').errors.required">This field is
                    required.</span>
                </app-control-error>
              </div>
            </div>
          </ng-container>

        </div> -->

        <ng-container *ngIf="payload.value">
          <div class="row">
            <div
              class="col clearfix"
              style="margin-top: 1em; margin-bottom: 0.5em"
            >
              <button
                type="button"
                (click)="addSensor()"
                class="btn btn-primary float-end"
              >
                Set Alert
              </button>
            </div>
          </div>
          <div class="row">
            <ngx-datatable
              class="bootstrap table-bordered table-striped table-hover"
              #companyListTable
              [rows]="payload.value?.sensors"
              [headerHeight]="50"
              [footerHeight]="50"
              [limit]="10"
              [columnMode]="'force'"
              [loadingIndicator]="payload.loading"
              [rowHeight]="'auto'"
            >
              <ngx-datatable-column name="Sensor Name" prop="sensorName">
                <ng-template let-row="row" ngx-datatable-cell-template>
                  <a
                    href="javascript:void(0);"
                    (click)="editHandler(row)"
                    placement="top"
                    ngbTooltip="Click to edit alert"
                  >
                    {{ row["sensorName"] }}
                  </a>
                </ng-template>
              </ngx-datatable-column>

              <ngx-datatable-column name="Min. Value" prop="minValue">
                <ng-template let-row="row" ngx-datatable-cell-template>
                  {{ row["minValue"] }}
                </ng-template>
              </ngx-datatable-column>

              <ngx-datatable-column name="Max. Value" prop="maxValue">
                <ng-template let-row="row" ngx-datatable-cell-template>
                  {{ row["maxValue"] }}
                </ng-template>
              </ngx-datatable-column>

              <ngx-datatable-column name="Measure" prop="measure">
                <ng-template let-row="row" ngx-datatable-cell-template>
                  {{ row["measureName"] }}
                </ng-template>
              </ngx-datatable-column>

              <ngx-datatable-column name="Tolerable Time" prop="tolerableTime">
                <ng-template let-row="row" ngx-datatable-cell-template>
                  {{ row["tolerableTime"] }}
                </ng-template>
              </ngx-datatable-column>

              <ngx-datatable-column
                name="Tolerable Time Name"
                prop="tolerableTime"
              >
                <ng-template let-row="row" ngx-datatable-cell-template>
                  {{ row["timeUnitName"] }}
                </ng-template>
              </ngx-datatable-column>

              <ngx-datatable-column name="Actions" [sortable]="false">
                <ng-template let-row="row" ngx-datatable-cell-template>
                  <a href="javascript:void(0);" (click)="deleteHandler(row)">
                    Delete
                  </a>
                </ng-template>
              </ngx-datatable-column>
            </ngx-datatable>
          </div>
        </ng-container>
        <div class="row" *ngIf="permission$ | async as payload">
          <div class="col" style="padding: 1em 0">
            <button
              type="button"
              (click)="cancelHandler()"
              aria-label="Close"
              [ngStyle]="{
                backgroundColor: '#fff',
                width: '10em',
                color: '#' + (primaryColour || '3D95F7'),
                fontSize: '16px',
                border: '1px solid #' + (primaryColour || '3D95F7'),
                borderRadius: '10px',
                height: '35px'
              }"
            >
              Close
            </button>
            <button
              *ngIf="payload.setup.deviceConfig.updater"
              type="button"
              (click)="saveHandler()"
              [disabled]="form.invalid || form.pristine"
              [ngStyle]="{
                backgroundColor: '#' + (primaryColour || '3D95F7'),
                width: '10em',
                color: '#ffffff',
                fontSize: '16px',
                border: '0',
                borderRadius: '10px',
                height: '35px'
              }"
              class="float-end"
            >
              Save
            </button>
          </div>
        </div>
      </div>
    </ng-container>
  </div>
</div>
<!-- </div> -->
